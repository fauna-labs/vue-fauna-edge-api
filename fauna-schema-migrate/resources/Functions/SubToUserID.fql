CreateFunction({
  name: "SubToUserID",
  body: Query(
    Lambda(
      [],
      Let(
        {
          jwtSub: CurrentIdentity(),
          delimiterPosition: Add(FindStr(Var("jwtSub"), "|"), 1),
          delimiterFound: GT(Var("delimiterPosition"), 0),
          userIDFromSub: If(
            Var("delimiterFound"),
            SubString(Var("jwtSub"), Var("delimiterPosition")),
            Var("jwtSub")
          )
        },
        Var("userIDFromSub")
      )
    )
  )
})